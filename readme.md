# Mind Castle API

Mind Castle is an API that allows users to create, manage, and share notes securely. It provides authentication, note creation, updating, deletion, search functionalities, and the ability to share notes with other users. The API is built using FastAPI and SQLAlchemy.

## Table of Contents
- [Features](#features)
- [Technologies](#technologies)
- [Setup](#setup)
  - [Running the API](#running-the-api)
  - [Docker Setup](#docker-setup)
- [Project Structure](#project-structure)
- [API Endpoints](#api-endpoints)
- [Testing](#testing)
- [Documentation](#documentation)
- [Technology Stack Selection and Rationale](#technology-stack-selection-and-rationale)

## Features
- **User Authentication:** Users can sign up, log in, and refresh their access tokens securely.
- **Note Management:** Create, update, delete, and search notes.
- **Sharing Notes:** Share notes with other users, manage shared notes, and update permissions.
- **Pagination:** Paginated API to view all notes shared with the authenticated user.

## Technologies
- FastAPI: A modern, fast (high-performance), web framework for building APIs with Python 3.7+.
- SQLAlchemy: SQL Toolkit and Object-Relational Mapping (ORM) for Python.
- Docker: Containerization for easy deployment.
- PostgreSQL: Database management system.

## Setup

### Example .env Structure

Create a .env file at the root of your project with the following structure:

```dotenv
DATABASE_HOSTNAME=mind-castle-db
DATABASE_PORT=5432
DATABASE_PASSWORD=pass
DATABASE_NAME=mind-castle
DATABASE_USERNAME=postgres

SECRET_KEY=09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7
REFRESH_SECRET_KEY=09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88esmark
ALGORITHM=HS256
ACCESS_EXPIRE_MINUTES=30
REFRESH_EXPIRE_MINUTES=1440

POSTGRES_USER=postgres
POSTGRES_PASSWORD=pass

DATABASE_TEST_URL=postgresql://postgres:pass@mind-castle-test-db/test-mind-castle
```

### Running the API

1. **Clone the Repository:**
    ```bash
    git clone https://github.com/smark-ARK/mind-castle.git
    cd mind-castle
    ```

2. **Install Dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

3. **Run Migrations:**
    ```bash
    alembic upgrade head
    ```

4. **Run the API:**
    ```bash
    uvicorn app.main:app --reload
    ```

### Docker Setup

1. **Build Docker Images:**
    ```bash
    docker-compose build
    ```

2. **Run Docker Containers:**
    ```bash
    docker-compose up
    ```

3. Access the API at [http://localhost:8000](http://localhost:8000)

## Project Structure

The project structure follows a standard FastAPI application layout:

- `app`: Contains the main FastAPI application code.
- `alembic`: Manages database migrations using Alembic.
- `tests`: Contains tests for the application.

## API Endpoints

- **Authentication:**
  - `/api/auth/signup`: Create a new user.
  - `/api/auth/login`: Log in and obtain access tokens.
  - `/api/auth/refresh`: Refresh access tokens.

- **Note Management:**
  - `/api/notes`: List all user notes.
  - `/api/notes/search`: Search user notes.
  - `/api/notes/{id}`: Get, update, or delete a specific note.
  - `/api/notes/share`: Share a note with another user.
  - `/api/notes/unshare`: Unshare a note with a user.
  - `/api/notes/update-share`: Update shared note permissions.

- **Shared Notes:**
  - `/notes/shared`: Paginated API to view all notes shared with the authenticated user.


## Testing

Tests are written using pytest-asyncio. To run the tests:

```bash
pytest
```

## Documentation

The API documentation is generated by FastAPI and is available at [http://localhost:8000/docs](http://localhost:8000/docs). The documentation provides an interactive interface to explore and test the API endpoints.

### Swagger UI

The Swagger UI allows you to interact with the API and make test requests. It presents a user-friendly interface with details about each API endpoint, request parameters, and response models. To use the Swagger UI:

1. Access the Swagger UI at [http://localhost:8000/docs](http://localhost:8000/docs) in your web browser.

2. Explore the available endpoints and methods.

3. Click on an endpoint to expand and see detailed information about request parameters, response models, and example requests.

4. Use the "Try it out" button to send requests and view responses directly within the Swagger UI.

### ReDoc

ReDoc is another documentation tool included with FastAPI, providing a clean and modern documentation interface. To use ReDoc:

1. Access ReDoc at [http://localhost:8000/redoc](http://localhost:8000/redoc) in your web browser.

2. Explore the API documentation with a clean and visually appealing design.

3. Click on endpoints to view detailed information about request parameters, response models, and example requests.

4. Use the "Try it out" button to send requests and view responses directly within the ReDoc interface.

Both Swagger UI and ReDoc offer an excellent way to understand, test, and interact with the Mind Castle API.


# Technology Stack Selection and Rationale

## FastAPI: A Swift and Efficient Framework

The choice of **FastAPI** as the primary web framework for Mind Castle was driven by several compelling factors. FastAPI stands out for its ease of use and rapid development capabilities, making it an ideal choice for quick project setup. The framework's integration with Swagger for automatic API documentation ensures a streamlined development process. Additionally, the support for asynchronous programming in FastAPI aligns seamlessly with the project's requirements, providing a performance boost for handling concurrent requests.

## PostgreSQL: A Robust Relational Database

Mind Castle's data structure and relationships are well-suited for a relational database, making **PostgreSQL** the natural and optimal choice. The clarity and flexibility offered by PostgreSQL in managing complex data relationships significantly influenced this decision. Leveraging my prior experience and familiarity with PostgreSQL played a crucial role in ensuring a smooth development process, as it is a robust and reliable relational database management system.

## SQLAlchemy: A Powerful ORM for Database Interaction

The integration of **SQLAlchemy** as the Object-Relational Mapping (ORM) tool aligns with best practices recommended by FastAPI. SQLAlchemy's popularity and comprehensive feature set make it an excellent choice for managing database interactions. Its compatibility with FastAPI facilitates the seamless integration of database operations into the application, enhancing maintainability and code readability.

## Alembic: Efficient Database Migrations

**Alembic** was chosen as the database migration tool to provide version control for the database schema. This decision enables the project to evolve over time, supporting backward compatibility and easy migration between different versions. Alembic's flexibility and compatibility with both FastAPI and SQLAlchemy make it a valuable asset in managing database changes.

## Custom OAuth2 Authentication: Tailored Security

The implementation of OAuth2 authentication was customized to meet the specific security requirements of Mind Castle. Providing refresh tokens in cookies enhances security and user experience. While FastAPI offers authentication utilities, a custom solution was preferred to align precisely with the project's authentication needs.

## Manual Rate Limiting with Token Bucket Algorithm

The decision to implement rate limiting manually using the Token Bucket Algorithm stemmed from a lack of reliable third-party libraries that met the project's requirements. By opting for a custom solution, Mind Castle ensures precise control over API rate limits, enhancing the application's resilience and performance.

In conclusion, the technology stack chosen for Mind Castle reflects a thoughtful consideration of factors such as ease of development, data management capabilities, security, and adaptability. Each component complements the others, resulting in a robust and efficient system tailored to the project's unique requirements.
